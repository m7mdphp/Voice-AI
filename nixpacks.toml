# Nixpacks configuration for Voice-AI backend deployment
[phases.setup]
nixPkgs = ["...", "python3", "python3Packages.pip"]

[phases.build]
cmds = [
  "pip3 install -r backend/requirements.txt --break-system-packages",
  "mkdir -p /app/frontend",
  "cp frontend/voice_assistant_v3.html /app/frontend/voice_assistant_v3.html || true",
  "cp frontend/voice_assistant_v4.html /app/frontend/voice_assistant_v4.html || true",
  "cp test-simple.html /app/test-simple.html || true",
  "chmod 644 /app/frontend/voice_assistant_v3.html || true",
  "chmod 644 /app/frontend/voice_assistant_v4.html || true",
  "chmod 644 /app/test-simple.html || true"
]

[start]
cmd = "cd backend && python main.py"

[variables]
PORT = "8000"
PYTHONPATH = "/app/backend"
PYTHONUNBUFFERED = "1"

# Deploy nginx configuration for static file serving
[deploy]
startCommand = "cp nginx.conf /etc/nginx/conf.d/default.conf && nginx -g 'daemon off;' && ./test-files.sh"
healthcheckPath = "/health"
healthcheckTimeout = 100
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 10
