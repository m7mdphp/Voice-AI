# Nixpacks configuration for Voice-AI backend deployment
[phases.setup]
nixPkgs = ["...", "python3", "python3Packages.pip"]

[phases.build]
cmds = [
  "pip3 install -r backend/requirements.txt --break-system-packages"
]

[start]
cmd = "cd backend && python main.py"

[variables]
PORT = "8000"
PYTHONPATH = "/app/backend"
PYTHONUNBUFFERED = "1"

# Deploy nginx configuration for static file serving
[deploy]
startCommand = "cp nginx.conf /etc/nginx/conf.d/default.conf && nginx -g 'daemon off;'"
healthcheckPath = "/health"
healthcheckTimeout = 100
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 10
